<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Plant-FATE: PPA</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-style-flat.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Plant-FATE
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('group__ppa__module.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">PPA</div>  </div>
</div><!--header-->
<div class="contents">

<p>This module collects functions and classes that together implement the Perfect Plasticity Approximation <br  />
  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gaabd97e8fa9e04d956f2ab4f8ac626c0b"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ppa__module.html#gaabd97e8fa9e04d956f2ab4f8ac626c0b">pfate::env::LightEnvironment::projected_crown_area_above_z</a> (double t, double z, Solver *S)</td></tr>
<tr class="memdesc:gaabd97e8fa9e04d956f2ab4f8ac626c0b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate the total crown area above height z, contributed by all individuals of the resident species.  <a href="group__ppa__module.html#gaabd97e8fa9e04d956f2ab4f8ac626c0b">More...</a><br /></td></tr>
<tr class="separator:gaabd97e8fa9e04d956f2ab4f8ac626c0b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gadb3ead4a0395e7913688d8917982a178"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ppa__module.html#gadb3ead4a0395e7913688d8917982a178">pfate::env::LightEnvironment::fapar_layer</a> (double t, int layer, Solver *S)</td></tr>
<tr class="separator:gadb3ead4a0395e7913688d8917982a178"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga82821a3a6e04cf1a798b0dbfe39ec685"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ppa__module.html#ga82821a3a6e04cf1a798b0dbfe39ec685">pfate::env::LightEnvironment::computeEnv</a> (double t, Solver *sol, std::vector&lt; double &gt;::iterator S, std::vector&lt; double &gt;::iterator dSdt) override</td></tr>
<tr class="memdesc:ga82821a3a6e04cf1a798b0dbfe39ec685"><td class="mdescLeft">&#160;</td><td class="mdescRight">Solver interface for updating the environment from the given state.  <a href="group__ppa__module.html#ga82821a3a6e04cf1a798b0dbfe39ec685">More...</a><br /></td></tr>
<tr class="separator:ga82821a3a6e04cf1a798b0dbfe39ec685"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad4dfa03054809f72d957ed9709b0a5b7"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ppa__module.html#gad4dfa03054809f72d957ed9709b0a5b7">plant::PlantArchitecture::crown_area_extent_projected</a> (double z, <a class="el" href="classplant_1_1PlantTraits.html">PlantTraits</a> &amp;traits)</td></tr>
<tr class="memdesc:gad4dfa03054809f72d957ed9709b0a5b7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Potential crown projection area at height z.  <a href="group__ppa__module.html#gad4dfa03054809f72d957ed9709b0a5b7">More...</a><br /></td></tr>
<tr class="separator:gad4dfa03054809f72d957ed9709b0a5b7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga4c6834623dae9423d2981a0b28b0f155"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ppa__module.html#ga4c6834623dae9423d2981a0b28b0f155">plant::PlantArchitecture::crown_area_above</a> (double z, <a class="el" href="classplant_1_1PlantTraits.html">PlantTraits</a> &amp;traits)</td></tr>
<tr class="memdesc:ga4c6834623dae9423d2981a0b28b0f155"><td class="mdescLeft">&#160;</td><td class="mdescRight">Realized crown projection area at height z.  <a href="group__ppa__module.html#ga4c6834623dae9423d2981a0b28b0f155">More...</a><br /></td></tr>
<tr class="separator:ga4c6834623dae9423d2981a0b28b0f155"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>This module collects functions and classes that together implement the Perfect Plasticity Approximation <br  />
 </p>
<h2 class="groupheader">Function Documentation</h2>
<a id="ga82821a3a6e04cf1a798b0dbfe39ec685"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga82821a3a6e04cf1a798b0dbfe39ec685">&#9670;&nbsp;</a></span>computeEnv()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void pfate::env::LightEnvironment::computeEnv </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Solver *&#160;</td>
          <td class="paramname"><em>sol</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; double &gt;::iterator&#160;</td>
          <td class="paramname"><em>_S</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; double &gt;::iterator&#160;</td>
          <td class="paramname"><em>_dSdt</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Solver interface for updating the environment from the given state. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">t</td><td>Time in current timestep. </td></tr>
    <tr><td class="paramname">sol</td><td>Pointer to the Solver being used, provided for computing state integrals. The Solver provides this via a <code>this</code> reference. </td></tr>
    <tr><td class="paramname">_S</td><td>Iterator to the <code>state</code> vector used by the ODE solver. </td></tr>
    <tr><td class="paramname">_dSdt</td><td>Iterator to the <code>rates</code> vector used by the ODE solver.</td></tr>
  </table>
  </dd>
</dl>
<p>This function must perform a complete update of the Environment, including any species or individual specific differences in the env. If Env is a function of E(x), the solver's SubdivisionSpline can be used to store E(x).</p>
<p>This function receives the updated state vector from the Solver's ODE stepper, from which the complete system state can be retrieved. This is the only function to which the Solver exposes the state vector, so if desired, the state vector can be saved from here and reused in other rate functions.</p>
<p>Interface to the rates vector can be used for computing the rates of ODE-based environmental variables if any such have been added as system variables - e.g., species-level seed pools can be implemented through this mechanism. <br  />
 </p>

<p class="definition">Definition at line <a class="el" href="light__environment_8cpp_source.html#l00102">102</a> of file <a class="el" href="light__environment_8cpp_source.html">light_environment.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;                                                                                                                     {</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <span class="comment">// updateClimate(t); // not done here. See comment in plantfate.cpp</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="comment">// std::cout &lt;&lt; &quot;update Env ... t = &quot; &lt;&lt; t &lt;&lt; &quot;: tc = &quot; &lt;&lt; clim_inst.tc &lt;&lt; &#39;\n&#39;;</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160; </div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="comment">//            _xm </span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <span class="comment">// Calculate / w(z,t)u(z,t)dz</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="comment">//        xb`</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classpfate_1_1env_1_1LightEnvironment.html#a27588f976abcb0b5e32271cb475c2ee6">use_ppa</a>){</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        <span class="keywordtype">double</span> fG = 0.99;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        <a class="code" href="classpfate_1_1env_1_1LightEnvironment.html#ad0fb245f9e2a9579f552dd53386f74e9">z_star</a>.clear();</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        <a class="code" href="classpfate_1_1env_1_1LightEnvironment.html#a779150676b2633c38e4021fed943312a">total_crown_area</a> = <a class="code" href="group__ppa__module.html#gaabd97e8fa9e04d956f2ab4f8ac626c0b">projected_crown_area_above_z</a>(t, 0, sol);</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        <a class="code" href="classpfate_1_1env_1_1LightEnvironment.html#a711bf79bbe90555457cc3758d6dfe09a">n_layers</a> = int(<a class="code" href="classpfate_1_1env_1_1LightEnvironment.html#a779150676b2633c38e4021fed943312a">total_crown_area</a>/fG); <span class="comment">// Total crown projection area </span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160; </div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        <span class="keywordflow">if</span> (n_layers &lt; 0 || n_layers &gt;= 50) {</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;            std::cout &lt;&lt; <span class="stringliteral">&quot;nlayers = &quot;</span> &lt;&lt; <a class="code" href="classpfate_1_1env_1_1LightEnvironment.html#a711bf79bbe90555457cc3758d6dfe09a">n_layers</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;            sol-&gt;print(); std::cout.flush();</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        }</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment">//          if (n_layers &gt; 5) n_layers = 5;</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        assert(<a class="code" href="classpfate_1_1env_1_1LightEnvironment.html#a711bf79bbe90555457cc3758d6dfe09a">n_layers</a> &gt;= 0 &amp;&amp; <a class="code" href="classpfate_1_1env_1_1LightEnvironment.html#a711bf79bbe90555457cc3758d6dfe09a">n_layers</a> &lt; 50);</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160; </div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> layer = 1; layer &lt;= <a class="code" href="classpfate_1_1env_1_1LightEnvironment.html#a711bf79bbe90555457cc3758d6dfe09a">n_layers</a>; ++layer){</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;            <span class="keyword">auto</span> CA_above_zstar_layer = [t, sol, layer, fG, <span class="keyword">this</span>](<span class="keywordtype">double</span> z) -&gt; <span class="keywordtype">double</span> {</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="group__ppa__module.html#gaabd97e8fa9e04d956f2ab4f8ac626c0b">projected_crown_area_above_z</a>(t, z, sol) - layer*fG;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;            };</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;            <span class="keyword">auto</span> res = pn::zero(0, 100, CA_above_zstar_layer, 1e-4);</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;            <a class="code" href="classpfate_1_1env_1_1LightEnvironment.html#ad0fb245f9e2a9579f552dd53386f74e9">z_star</a>.push_back(res.root);</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment">//              std::cout &lt;&lt; &quot;z*(&quot; &lt;&lt; layer &lt;&lt; &quot;) = &quot; &lt;&lt; res.root &lt;&lt; &quot;, CA(z*) = &quot; &lt;&lt; projected_crown_area_above_z(t, res.root, S) &lt;&lt; &quot;, &quot; &lt;&lt; &quot;iter = &quot; &lt;&lt; res.nfnct &lt;&lt; &quot;\n&quot;;</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        }</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        <a class="code" href="classpfate_1_1env_1_1LightEnvironment.html#ad0fb245f9e2a9579f552dd53386f74e9">z_star</a>.push_back(0);</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        <span class="comment">//std::cout &lt;&lt; &quot;z*_vec (&quot; &lt;&lt; z_star.size() &lt;&lt; &quot;) = &quot;; for(auto z: z_star) std::cout &lt;&lt; z &lt;&lt; &quot; &quot;; cout &lt;&lt; &quot;\n&quot;; cout.flush();</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        assert(<a class="code" href="classpfate_1_1env_1_1LightEnvironment.html#ad0fb245f9e2a9579f552dd53386f74e9">z_star</a>.size() == <a class="code" href="classpfate_1_1env_1_1LightEnvironment.html#a711bf79bbe90555457cc3758d6dfe09a">n_layers</a>+1);</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        <a class="code" href="classpfate_1_1env_1_1LightEnvironment.html#a0b0fb6ef5309bf9f20e0e1a8ff194e3d">canopy_openness</a>.clear();</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        <a class="code" href="classpfate_1_1env_1_1LightEnvironment.html#aa698745e004cd01df478286e46eebbdb">fapar_tot</a>.clear();</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        <a class="code" href="classpfate_1_1env_1_1LightEnvironment.html#a0b0fb6ef5309bf9f20e0e1a8ff194e3d">canopy_openness</a>.resize(<a class="code" href="classpfate_1_1env_1_1LightEnvironment.html#a711bf79bbe90555457cc3758d6dfe09a">n_layers</a>+1);  </div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        <a class="code" href="classpfate_1_1env_1_1LightEnvironment.html#aa698745e004cd01df478286e46eebbdb">fapar_tot</a>.resize(<a class="code" href="classpfate_1_1env_1_1LightEnvironment.html#a711bf79bbe90555457cc3758d6dfe09a">n_layers</a>);</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        <a class="code" href="classpfate_1_1env_1_1LightEnvironment.html#a0b0fb6ef5309bf9f20e0e1a8ff194e3d">canopy_openness</a>[0] = 1; <span class="comment">// top layer gets 100% light</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> layer = 0; layer &lt; <a class="code" href="classpfate_1_1env_1_1LightEnvironment.html#a711bf79bbe90555457cc3758d6dfe09a">n_layers</a>; ++layer){  </div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;            <a class="code" href="classpfate_1_1env_1_1LightEnvironment.html#aa698745e004cd01df478286e46eebbdb">fapar_tot</a>[layer] = <a class="code" href="group__ppa__module.html#gadb3ead4a0395e7913688d8917982a178">fapar_layer</a>(t, layer, sol);</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;            <a class="code" href="classpfate_1_1env_1_1LightEnvironment.html#a0b0fb6ef5309bf9f20e0e1a8ff194e3d">canopy_openness</a>[layer+1] = <a class="code" href="classpfate_1_1env_1_1LightEnvironment.html#a0b0fb6ef5309bf9f20e0e1a8ff194e3d">canopy_openness</a>[layer] * (1-<a class="code" href="classpfate_1_1env_1_1LightEnvironment.html#aa698745e004cd01df478286e46eebbdb">fapar_tot</a>[layer]);</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        }</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        </div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    }</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;Only PPA mode is implemented currently. Set use_ppa to true&quot;</span>);</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        <span class="comment">// auto canopy_openness = [S, t, this](double z){</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        <span class="comment">//  double kI = 0.5;</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160; </div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        <span class="comment">//  double leaf_area_above_z = LA_above_z(t,z,S);</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        <span class="comment">//  //cout &lt;&lt; &quot;LA(&quot; &lt;&lt; z &lt;&lt; &quot;) = &quot; &lt;&lt; exp(-kI*leaf_area_above_z) &lt;&lt; &quot;\n&quot;;</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        <span class="comment">//  return exp(-kI*leaf_area_above_z);</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        <span class="comment">// };   </span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160; </div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        <span class="comment">// //cout &lt;&lt; S-&gt;xb &lt;&lt; &quot; &quot; &lt;&lt; S-&gt;getMaxSize() &lt;&lt; endl;   </span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        <span class="comment">// //time = t;</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        <span class="comment">// //for (int s=0; s&lt;S-&gt;n_species(); ++s) S-&gt;get_species(s)-&gt;u0_save = S-&gt;get_u0(t, s);</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        <span class="comment">// light_profile.construct(canopy_openness, 0, S-&gt;maxSize());</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    }   </div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;}</div>
<div class="ttc" id="aclasspfate_1_1env_1_1LightEnvironment_html_a0b0fb6ef5309bf9f20e0e1a8ff194e3d"><div class="ttname"><a href="classpfate_1_1env_1_1LightEnvironment.html#a0b0fb6ef5309bf9f20e0e1a8ff194e3d">pfate::env::LightEnvironment::canopy_openness</a></div><div class="ttdeci">std::vector&lt; double &gt; canopy_openness</div><div class="ttdef"><b>Definition:</b> <a href="light__environment_8h_source.html#l00023">light_environment.h:23</a></div></div>
<div class="ttc" id="aclasspfate_1_1env_1_1LightEnvironment_html_a27588f976abcb0b5e32271cb475c2ee6"><div class="ttname"><a href="classpfate_1_1env_1_1LightEnvironment.html#a27588f976abcb0b5e32271cb475c2ee6">pfate::env::LightEnvironment::use_ppa</a></div><div class="ttdeci">bool use_ppa</div><div class="ttdef"><b>Definition:</b> <a href="light__environment_8h_source.html#l00014">light_environment.h:14</a></div></div>
<div class="ttc" id="aclasspfate_1_1env_1_1LightEnvironment_html_a711bf79bbe90555457cc3758d6dfe09a"><div class="ttname"><a href="classpfate_1_1env_1_1LightEnvironment.html#a711bf79bbe90555457cc3758d6dfe09a">pfate::env::LightEnvironment::n_layers</a></div><div class="ttdeci">int n_layers</div><div class="ttdef"><b>Definition:</b> <a href="light__environment_8h_source.html#l00019">light_environment.h:19</a></div></div>
<div class="ttc" id="aclasspfate_1_1env_1_1LightEnvironment_html_a779150676b2633c38e4021fed943312a"><div class="ttname"><a href="classpfate_1_1env_1_1LightEnvironment.html#a779150676b2633c38e4021fed943312a">pfate::env::LightEnvironment::total_crown_area</a></div><div class="ttdeci">double total_crown_area</div><div class="ttdef"><b>Definition:</b> <a href="light__environment_8h_source.html#l00020">light_environment.h:20</a></div></div>
<div class="ttc" id="aclasspfate_1_1env_1_1LightEnvironment_html_aa698745e004cd01df478286e46eebbdb"><div class="ttname"><a href="classpfate_1_1env_1_1LightEnvironment.html#aa698745e004cd01df478286e46eebbdb">pfate::env::LightEnvironment::fapar_tot</a></div><div class="ttdeci">std::vector&lt; double &gt; fapar_tot</div><div class="ttdef"><b>Definition:</b> <a href="light__environment_8h_source.html#l00022">light_environment.h:22</a></div></div>
<div class="ttc" id="aclasspfate_1_1env_1_1LightEnvironment_html_ad0fb245f9e2a9579f552dd53386f74e9"><div class="ttname"><a href="classpfate_1_1env_1_1LightEnvironment.html#ad0fb245f9e2a9579f552dd53386f74e9">pfate::env::LightEnvironment::z_star</a></div><div class="ttdeci">std::vector&lt; double &gt; z_star</div><div class="ttdef"><b>Definition:</b> <a href="light__environment_8h_source.html#l00021">light_environment.h:21</a></div></div>
<div class="ttc" id="agroup__ppa__module_html_gaabd97e8fa9e04d956f2ab4f8ac626c0b"><div class="ttname"><a href="group__ppa__module.html#gaabd97e8fa9e04d956f2ab4f8ac626c0b">pfate::env::LightEnvironment::projected_crown_area_above_z</a></div><div class="ttdeci">double projected_crown_area_above_z(double t, double z, Solver *S)</div><div class="ttdoc">Calculate the total crown area above height z, contributed by all individuals of the resident species...</div><div class="ttdef"><b>Definition:</b> <a href="light__environment_8cpp_source.html#l00032">light_environment.cpp:32</a></div></div>
<div class="ttc" id="agroup__ppa__module_html_gadb3ead4a0395e7913688d8917982a178"><div class="ttname"><a href="group__ppa__module.html#gadb3ead4a0395e7913688d8917982a178">pfate::env::LightEnvironment::fapar_layer</a></div><div class="ttdeci">double fapar_layer(double t, int layer, Solver *S)</div><div class="ttdef"><b>Definition:</b> <a href="light__environment_8cpp_source.html#l00056">light_environment.cpp:56</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="group__ppa__module_ga82821a3a6e04cf1a798b0dbfe39ec685_cgraph.svg" width="504" height="118"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="ga4c6834623dae9423d2981a0b28b0f155"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga4c6834623dae9423d2981a0b28b0f155">&#9670;&nbsp;</a></span>crown_area_above()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double plant::PlantArchitecture::crown_area_above </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>z</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classplant_1_1PlantTraits.html">PlantTraits</a> &amp;&#160;</td>
          <td class="paramname"><em>traits</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Realized crown projection area at height z. </p>
<p>This is the area within the potential crown that is actually occupied by leaves <br  />
 </p>

<p class="definition">Definition at line <a class="el" href="plant__architecture_8cpp_source.html#l00067">67</a> of file <a class="el" href="plant__architecture_8cpp_source.html">plant_architecture.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;                                                                       {</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="keywordflow">if</span> (z == 0) <span class="keywordflow">return</span> <a class="code" href="classplant_1_1PlantArchitecture.html#ac226e872ce60e9aa6780b48baa5e1bc8">crown_area</a>; <span class="comment">// shortcut because z=0 is used often</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160; </div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <span class="keywordtype">double</span> fq = <a class="code" href="classplant_1_1PlantArchitecture.html#a81452fb0a56656f176f653d3bf9650d9">q</a>(z)/<a class="code" href="classplant_1_1PlantArchitecture.html#a5ca80cd3052e16bb0b1781a13a91eb0c">geom</a>.qm;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="keywordflow">if</span> (z &gt;= <a class="code" href="classplant_1_1PlantArchitecture.html#a4d571b1b0165d995f3d2ca0fe21a4b28">zm</a>()){</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classplant_1_1PlantArchitecture.html#ac226e872ce60e9aa6780b48baa5e1bc8">crown_area</a> * fq*fq * (1-<a class="code" href="classplant_1_1PlantArchitecture.html#a5ca80cd3052e16bb0b1781a13a91eb0c">geom</a>.fg);</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    } </div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classplant_1_1PlantArchitecture.html#ac226e872ce60e9aa6780b48baa5e1bc8">crown_area</a> * (1 - fq*fq * <a class="code" href="classplant_1_1PlantArchitecture.html#a5ca80cd3052e16bb0b1781a13a91eb0c">geom</a>.fg);</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    }</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;}</div>
<div class="ttc" id="aclassplant_1_1PlantArchitecture_html_a4d571b1b0165d995f3d2ca0fe21a4b28"><div class="ttname"><a href="classplant_1_1PlantArchitecture.html#a4d571b1b0165d995f3d2ca0fe21a4b28">plant::PlantArchitecture::zm</a></div><div class="ttdeci">double zm()</div><div class="ttdoc">The height at which crown radius is maximum.</div><div class="ttdef"><b>Definition:</b> <a href="plant__architecture_8cpp_source.html#l00045">plant_architecture.cpp:45</a></div></div>
<div class="ttc" id="aclassplant_1_1PlantArchitecture_html_a5ca80cd3052e16bb0b1781a13a91eb0c"><div class="ttname"><a href="classplant_1_1PlantArchitecture.html#a5ca80cd3052e16bb0b1781a13a91eb0c">plant::PlantArchitecture::geom</a></div><div class="ttdeci">struct plant::PlantArchitecture::@9 geom</div><div class="ttdoc">Traits that control dimensional scaling.</div></div>
<div class="ttc" id="aclassplant_1_1PlantArchitecture_html_a81452fb0a56656f176f653d3bf9650d9"><div class="ttname"><a href="classplant_1_1PlantArchitecture.html#a81452fb0a56656f176f653d3bf9650d9">plant::PlantArchitecture::q</a></div><div class="ttdeci">double q(double z)</div><div class="ttdoc">Vertical profiles of crown and stem</div><div class="ttdef"><b>Definition:</b> <a href="plant__architecture_8cpp_source.html#l00035">plant_architecture.cpp:35</a></div></div>
<div class="ttc" id="aclassplant_1_1PlantArchitecture_html_ac226e872ce60e9aa6780b48baa5e1bc8"><div class="ttname"><a href="classplant_1_1PlantArchitecture.html#ac226e872ce60e9aa6780b48baa5e1bc8">plant::PlantArchitecture::crown_area</a></div><div class="ttdeci">double crown_area</div><div class="ttdoc">Crown area.</div><div class="ttdef"><b>Definition:</b> <a href="plant__architecture_8h_source.html#l00043">plant_architecture.h:43</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="group__ppa__module_ga4c6834623dae9423d2981a0b28b0f155_cgraph.svg" width="436" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="group__ppa__module_ga4c6834623dae9423d2981a0b28b0f155_icgraph.svg" width="1800" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="gad4dfa03054809f72d957ed9709b0a5b7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gad4dfa03054809f72d957ed9709b0a5b7">&#9670;&nbsp;</a></span>crown_area_extent_projected()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double plant::PlantArchitecture::crown_area_extent_projected </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>z</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classplant_1_1PlantTraits.html">PlantTraits</a> &amp;&#160;</td>
          <td class="paramname"><em>traits</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Potential crown projection area at height z. </p>
<p>This is the total area that can <br  />
 be potentially occupied by leaves, including the area that currently consists of gaps. </p><p class="formulaDsp">
\[A_{cp} = \pi r(z)^2 = \pi r_0^2 q(z)^2 = (A_c/q_m^2) q(z)^2 = A_c (q(z)/q_m)^2\]
</p>
 
<p class="definition">Definition at line <a class="el" href="plant__architecture_8cpp_source.html#l00054">54</a> of file <a class="el" href="plant__architecture_8cpp_source.html">plant_architecture.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;                                                                                  {</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="keywordflow">if</span> (z &gt;= <a class="code" href="classplant_1_1PlantArchitecture.html#a4d571b1b0165d995f3d2ca0fe21a4b28">zm</a>()){</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;        <span class="keywordtype">double</span> fq = <a class="code" href="classplant_1_1PlantArchitecture.html#a81452fb0a56656f176f653d3bf9650d9">q</a>(z)/<a class="code" href="classplant_1_1PlantArchitecture.html#a5ca80cd3052e16bb0b1781a13a91eb0c">geom</a>.qm;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classplant_1_1PlantArchitecture.html#ac226e872ce60e9aa6780b48baa5e1bc8">crown_area</a> * fq*fq;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    } </div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classplant_1_1PlantArchitecture.html#ac226e872ce60e9aa6780b48baa5e1bc8">crown_area</a>;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    }</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="group__ppa__module_gad4dfa03054809f72d957ed9709b0a5b7_cgraph.svg" width="484" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="gadb3ead4a0395e7913688d8917982a178"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gadb3ead4a0395e7913688d8917982a178">&#9670;&nbsp;</a></span>fapar_layer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double pfate::env::LightEnvironment::fapar_layer </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>layer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Solver *&#160;</td>
          <td class="paramname"><em>S</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="light__environment_8cpp_source.html#l00056">56</a> of file <a class="el" href="light__environment_8cpp_source.html">light_environment.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;                                                                  {</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160; </div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="keywordtype">double</span> photons_abs = 0;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=0; k&lt;S-&gt;species_vec.size(); ++k){</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        </div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;        <span class="comment">// skip mutants</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;        <span class="keyword">auto</span> spp = <span class="keyword">static_cast&lt;</span>AdaptiveSpecies&lt;PSPM_Plant&gt;*<span class="keyword">&gt;</span>(S-&gt;species_vec[k]);</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;        <span class="keywordflow">if</span> (!spp-&gt;isResident) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160; </div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;        <span class="keyword">auto</span> photons_absorbed_plant_layer = [layer,spp, <span class="keyword">this</span>](<span class="keywordtype">int</span> i, <span class="keywordtype">double</span> t){</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;            <span class="keyword">auto</span>&amp; p = spp-&gt;getCohort(i);</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160; </div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;            <span class="keywordtype">double</span> cap_z    =            p.geometry.crown_area_above(<a class="code" href="classpfate_1_1env_1_1LightEnvironment.html#ad0fb245f9e2a9579f552dd53386f74e9">z_star</a>[layer], p.traits);</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;            <span class="keywordtype">double</span> cap_ztop = (layer&gt;0)? p.geometry.crown_area_above(<a class="code" href="classpfate_1_1env_1_1LightEnvironment.html#ad0fb245f9e2a9579f552dd53386f74e9">z_star</a>[layer-1], p.traits) : 0;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;            <span class="keywordtype">double</span> cap_layer = cap_z - cap_ztop;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;            </div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;            <span class="keywordtype">double</span> Iabs_plant_layer = cap_layer * (1 - exp(-p.par.k_light * p.geometry.lai));</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">//              std::cout &lt;&lt; &quot;(&quot; &lt;&lt; i &lt;&lt; &quot;,&quot; &lt;&lt; p.geometry.diameter &lt;&lt; &quot;, &quot; &lt;&lt; p.geometry.height &lt;&lt; &quot;, &quot; &lt;&lt; p.u &lt;&lt; &quot;, &quot; &lt;&lt; p.geometry.crown_area &lt;&lt; &quot;, &quot; &lt;&lt; cap_layer &lt;&lt; &quot;, &quot; &lt;&lt; p.geometry.lai &lt;&lt; &quot; | &quot; &lt;&lt; Iabs_plant_layer &lt;&lt; &quot;)&quot; &lt;&lt; &quot;\n&quot;;</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;            <span class="keywordflow">return</span> Iabs_plant_layer;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        };</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment">//          std::cout &lt;&lt; &quot;\n&quot;;</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        photons_abs += S-&gt;state_integral(photons_absorbed_plant_layer, t, k);</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    }       </div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="keywordflow">return</span> photons_abs;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="group__ppa__module_gadb3ead4a0395e7913688d8917982a178_icgraph.svg" width="480" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="gaabd97e8fa9e04d956f2ab4f8ac626c0b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaabd97e8fa9e04d956f2ab4f8ac626c0b">&#9670;&nbsp;</a></span>projected_crown_area_above_z()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double pfate::env::LightEnvironment::projected_crown_area_above_z </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>z</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Solver *&#160;</td>
          <td class="paramname"><em>S</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculate the total crown area above height z, contributed by all individuals of the resident species. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">t</td><td>Time in current timestep. </td></tr>
    <tr><td class="paramname">z</td><td>distance from the ground </td></tr>
    <tr><td class="paramname">S</td><td>Pointer to the Solver being used. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Total crown area above z</dd></dl>
<p>The crown area above z from all individuals of species <code>k</code> is calculated as </p><p class="formulaDsp">
\[A_k = \int_{x_b}^{x_m}{A_{cp}(s)u(s)ds},\]
</p>
<p> where \(A_{cp}\) is the projected crown area at height z, including area covered by gaps. This is calculated by the function <a class="el" href="group__ppa__module.html#gad4dfa03054809f72d957ed9709b0a5b7" title="Potential crown projection area at height z.">plant::PlantArchitecture::crown_area_extent_projected</a>. <br  />
 The total crown area above z is the </p><p class="formulaDsp">
\[A = \sum_k {A_k}\]
</p>
 
<p class="definition">Definition at line <a class="el" href="light__environment_8cpp_source.html#l00032">32</a> of file <a class="el" href="light__environment_8cpp_source.html">light_environment.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;                                                                                  {</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    <span class="keywordtype">double</span> ca_above_z = 0;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    <span class="comment">// Loop over resident species ---&gt;</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=0; k&lt;S-&gt;species_vec.size(); ++k){</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160; </div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;        <span class="comment">// skip mutants</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;        <span class="keyword">auto</span> spp = <span class="keyword">static_cast&lt;</span>AdaptiveSpecies&lt;PSPM_Plant&gt;*<span class="keyword">&gt;</span>(S-&gt;species_vec[k]);</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;        <span class="keywordflow">if</span> (!spp-&gt;isResident) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160; </div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;        <span class="keyword">auto</span> ca_above = [z,spp](<span class="keywordtype">int</span> i, <span class="keywordtype">double</span> t){</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;            <span class="keyword">auto</span>&amp; p = spp-&gt;getCohort(i);</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">//              double a = p.area_leaf_above(z, p.vars.height, p.vars.area_leaf);</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;            <span class="keywordtype">double</span> ca_p = p.geometry.crown_area_extent_projected(z, p.traits);</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">//              std::cout &lt;&lt; &quot;(&quot; &lt;&lt; i &lt;&lt; &quot;,&quot; &lt;&lt; p.geometry.get_size() &lt;&lt; &quot;, &quot; &lt;&lt; p.geometry.diameter &lt;&lt; &quot;, &quot; &lt;&lt; p.geometry.height &lt;&lt; &quot;, &quot; &lt;&lt; p.u &lt;&lt; &quot;, &quot; &lt;&lt; p.geometry.crown_area &lt;&lt; &quot; | &quot; &lt;&lt; ca_p &lt;&lt; &quot;)&quot; &lt;&lt; &quot;\n&quot;;</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;            <span class="keywordflow">return</span> ca_p;    </div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;        };</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">//          ca_above_z += S-&gt;integrate_wudx_above(ca_above, t, z, k);</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">//          std::cout &lt;&lt; &quot;\n&quot;;</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;        ca_above_z += S-&gt;state_integral(ca_above, t, k);</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    }</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="keywordflow">return</span> ca_above_z;  </div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="group__ppa__module_gaabd97e8fa9e04d956f2ab4f8ac626c0b_icgraph.svg" width="504" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
